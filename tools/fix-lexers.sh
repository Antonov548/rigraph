#!/bin/bash
#
# Fixes the lexers generated by bison/flex so they don't have exit()
# statements (which we won't hit anyway)

for fname in src/core/io/*-lexer.c; do
    cat ${fname} | grep -v '^\s*exit.*YY_EXIT_FAILURE' >${fname}.new
    mv ${fname}.new ${fname}
	sed -e 's/^\([^#]*\)yynoreturn /\1__attribute__((unused)) /g' ${fname} >${fname}.new
    mv ${fname}.new ${fname}
done

for fname in src/core/io/*-parser.[cy] src/core/io/*-lexer.[cl]; do
    sed -e 's,io/parsers,io,g' ${fname} >${fname}.new
    mv ${fname}.new ${fname}
done

